
<div class="resume-section-content">
  <h2 class="mb-5">Publications</h2>

  <h3>Peer-reviewed journal articles</h3>

  <ul class="fa-ul">
    {% for item in site.data.publications.journal_articles %}
      <li class="text-justify mb-1">
        <span class="fa-li"><i class="fas fa-book-reader"></i></span>
        {% if item.url %}
          {{ item.citation }}, <a href="{{ item.url }}">{{ item.url }}</a>
        {% elsif item.doi %}
          {{ item.citation }}, <a href="https://doi.org/{{ item.doi }}">{{ item.doi }}</a>
        {% else %}
          {{ item.citation }}
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  <h3>Conference proceedings</h3>

  <ul class="fa-ul">
    {% for item in site.data.publications.proceedings %}
      <li class="text-justify mb-1">
        <span class="fa-li"><i class="fas fa-book-reader"></i></span>
        {% if item.url %}
          {{ item.citation }}, <a href="{{ item.url }}">{{ item.url }}</a>
        {% elsif item.doi %}
          {{ item.citation }}, <a href="https://doi.org/{{ item.doi }}">{{ item.doi }}</a>
        {% else %}
          {{ item.citation }}
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  <h3 class="mt-4">Blog posts on Medium.com</h3>

  {% comment %}
    Using RSS2JSON API to display individual Medium posts
    see https://rss2json.com/
  {% endcomment %}

  <div id="medium-widget" class="row mt-3"></div>

  <script>
    fetch('https://api.rss2json.com/v1/api.json?rss_url=https://medium.com/feed/@paolo-cozzi')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('medium-widget');
        const posts = data.items.slice(0, 6); // Show last 6 posts

        posts.forEach(post => {
          // Extract first image from content/description
          let thumbnail = post.thumbnail;

          // Try to extract image from content or description HTML
          if (!thumbnail) {
            const content = post.content || post.description || '';
            const imgMatch = content.match(/<img[^>]+src="([^">]+)"/);
            if (imgMatch && imgMatch[1]) {
              thumbnail = imgMatch[1];
            }
          }

          // Use enclosure as fallback
          if (!thumbnail && post.enclosure && post.enclosure.link) {
            thumbnail = post.enclosure.link;
          }

          // Final fallback: Medium default image
          if (!thumbnail) {
            thumbnail = 'https://cdn-images-1.medium.com/max/1200/1*6_fgYnisCa9V21mymySIvA.png';
          }

          // Clean description - extract text without HTML tags
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = post.description || post.content || '';
          const description = tempDiv.textContent.substring(0, 150).trim() + '...';

          const article = `
            <div class="col-md-4 mb-4">
              <div class="card h-100">
                <img src="${thumbnail}" class="card-img-top" alt="${post.title}" style="object-fit: cover; height: 200px;">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">${post.title}</h5>
                  <p class="card-text text-muted small">${new Date(post.pubDate).toLocaleDateString('it-IT')}</p>
                  <p class="card-text">${description}</p>
                  <a href="${post.link}" class="btn btn-primary mt-auto" target="_blank">Read more</a>
                </div>
              </div>
            </div>
          `;
          container.innerHTML += article;
        });
      })
      .catch(err => {
        document.getElementById('medium-widget').innerHTML =
          '<div class="col-12"><p class="text-muted">Unable to load Medium posts. Visit <a href="https://medium.com/@paolo-cozzi" target="_blank">my Medium profile</a>.</p></div>';
      });
  </script>

</div>
